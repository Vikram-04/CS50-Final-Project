{% extends "layout.html" %} {% block title %}Todo{% endblock %} {% block body %}
<form action="/todo" method="post" class="task-form p-3 mt-5">
  <div class="form-group">
    <input
      class="form-control"
      type="text"
      placeholder="Task"
      autocomplete="off"
      name="task"
      required
    />
  </div>

  <div class="form-group">
    <button class="btn btn-primary">Add Task</button>
  </div>
</form>
<div id="todo-container">
  <div class="list-container">
    <h3 class="list-head">Tasks</h3>
    <ol id="todo-list">
      {% for row in tasks %} {% if row.done == False %}
      <li class="todo-task" data-task-id="{{ row.id }}">{{ row.task }}</li>
      {% endif %} {% endfor %}
    </ol>
  </div>
  <div class="list-container">
    <h3 class="list-head">Completed tasks</h3>
    <button id="clear-all-btn">Clear All</button>
    <ol id="completed-list">
      {% for row in tasks %} {% if row.done == True %}
      <li class="task-done" data-task-id="{{ row.id }}">{{ row.task }}</li>
      {% endif %} {% endfor %}
    </ol>
  </div>
</div>
<script>
  let completed_list = document.querySelector("#completed-list");
  document.querySelectorAll(".todo-task").forEach((task) => {
    task.addEventListener("click", () => {
      const taskId = task.dataset.taskId;
      fetch("/mark_done", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ task_id: taskId }),
      })
        .then((res) => res.json())
        .then((data) => {
          task.classList.remove("todo-task");
          task.classList.add("task-done");
          let newTask = task.cloneNode(true);
          newTask.addEventListener("click", () => {
            fetch("/remove_task", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ task_id: taskId }),
            })
              .then((res) => res.json())
              .then((data) => {
                newTask.remove();
              });
          });
          completed_list.appendChild(newTask);
          task.remove();
        });
    });
  });
  document.querySelectorAll(".task-done").forEach((task) => {
    task.addEventListener("click", () => {
      const taskId = task.dataset.taskId;
      fetch("/remove_task", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ task_id: taskId }),
      })
        .then((res) => res.json())
        .then((data) => {
          task.remove();
        });
    });
  });
  document.querySelector("#clear-all-btn").addEventListener("click", () => {
    fetch("/clear_all_tasks", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
    })
      .then((res) => res.json())
      .then((data) => {
        document.querySelector("#completed-list").innerHTML = "";
      });
  });
</script>
{% endblock %}
